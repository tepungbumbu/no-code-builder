import { NextRequest, NextResponse } from 'next/server';

// In-memory project storage
declare global {
  var projects: any[];
}

global.projects = global.projects || [];

// GET all projects
export async function GET(request: NextRequest) {
  try {
    const authHeader = request.headers.get('authorization');
    if (!authHeader) {
      return NextResponse.json({ message: 'Unauthorized' }, { status: 401 });
    }

    const token = authHeader.replace('Bearer ', '');
    const decoded = JSON.parse(Buffer.from(token, 'base64').toString());

    // Filter projects by user
    const userProjects = global.projects.filter(p => p.userId === decoded.userId);

    return NextResponse.json(userProjects);
  } catch (error) {
    return NextResponse.json({ message: 'Failed to fetch projects' }, { status: 500 });
  }
}

// POST create project
export async function POST(request: NextRequest) {
  try {
    const authHeader = request.headers.get('authorization');
    if (!authHeader) {
      return NextResponse.json({ message: 'Unauthorized' }, { status: 401 });
    }

    const token = authHeader.replace('Bearer ', '');
    const decoded = JSON.parse(Buffer.from(token, 'base64').toString());

    // Helper to generate IDs (duplicated to avoid import issues in API route)
    const generateId = () => `${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;

    const { name, template } = await request.json();

    // Default Structure (Header, Content, Footer)
    const defaultStructure = [
      // Header Section
      {
        id: generateId(),
        type: 'container',
        props: { tagName: 'header' },
        styles: {
          desktop: {
            width: '100%',
          },
        },
        children: [
          // Nav
          {
            id: generateId(),
            type: 'container',
            props: { tagName: 'nav' },
            styles: {
              desktop: {
                display: 'flex',
                flexWrap: 'wrap',
                alignItems: 'center',
                justifyContent: 'center',
                width: '100%',
                padding: '16px', // py-4 px-4
                fontSize: '18px', // text-lg
                color: '#374151', // text-gray-700
                backgroundColor: '#ffffff', // bg-white
                position: 'relative',
                zIndex: '50',
              },
              tablet: {
                paddingTop: '0', // md:py-0
                paddingBottom: '0',
              },
            },
            children: [
              // Logo Container
              {
                id: generateId(),
                type: 'container',
                props: {},
                styles: {
                  desktop: {},
                },
                children: [
                  {
                    id: generateId(),
                    type: 'image',
                    props: {
                      src: 'data:image/svg+xml,%3C%3Fxml%20version%3D%221.0%22%20encoding%3D%22UTF-8%22%3F%3E%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22340%22%20height%3D%2265%22%3E%3Cpath%20d%3D%22M0%200%20C4.29%200%208.58%200%2013%200%20C13%2020.46%2013%2040.92%2013%2062%20C8.71%2062%204.42%2062%200%2062%20C0%2061.34%200%2060.68%200%2060%20C-0.99%2060.495%20-1.98%2060.99%20-3%2061.5%20C-7.76401031%2063.50337657%20-12.14641379%2063.90282954%20-17.07421875%2062.34375%20C-23.04502302%2059.70522316%20-27.24123269%2055.54162732%20-30.140625%2049.703125%20C-32.20986775%2043.19441599%20-32.27246784%2034.79046513%20-29.4375%2028.5%20C-26.3499148%2023.37966299%20-21.537206%2019.25628207%20-16%2017%20C-13.59765625%2016.734375%20-13.59765625%2016.734375%20-11.0625%2016.75%20C-10.22847656%2016.74484375%20-9.39445312%2016.7396875%20-8.53515625%2016.734375%20C-6%2017%20-6%2017%20-1%2019%20C-0.67%2012.73%20-0.34%206.46%200%200%20Z%20M-19%2033%20C-20.85269921%2036.70539842%20-20.46444489%2040.95623313%20-20%2045%20C-18.68882399%2048.11326625%20-17.09390848%2050.45304576%20-14%2052%20C-10.268148%2052.41465022%20-8.48562474%2052.297997%20-5.25%2050.3125%20C-1.87779968%2046.84662745%20-1.1224119%2044.34653087%20-0.6875%2039.5625%20C-1.03135866%2035.64251125%20-1.91655875%2033.3180731%20-4%2030%20C-10.19158708%2025.87227528%20-14.53850971%2027.48874729%20-19%2033%20Z%20%22%20fill%3D%22%2320409A%22%20transform%3D%22translate(33%2C1)%22%2F%3E%3Cpath%20d%3D%22M0%200%20C4.29%200%208.58%200%2013%200%20C13.33%2010.23%2013.66%2020.46%2014%2031%20C19.9291866%2025.31255568%2019.9291866%2025.31255568%2025.046875%2018.95703125%20C27%2017%2027%2017%2030.890625%2016.51171875%20C32.3445554%2016.54476262%2033.79808575%2016.60413037%2035.25%2016.6875%20C35.99507812%2016.71005859%2036.74015625%2016.73261719%2037.5078125%2016.75585938%20C39.339409%2016.81456439%2041.16996653%2016.90424243%2043%2017%20C43%2017.66%2043%2018.32%2043%2019%20C41.49609375%2020.48046875%2041.49609375%2020.48046875%2039.4375%2022.1875%20C35.13287718%2025.87611923%2035.13287718%2025.87611923%2030.9375%2029.6875%20C30.34839844%2030.22761719%2029.75929687%2030.76773437%2029.15234375%2031.32421875%20C27.77178975%2032.92328769%2027.77178975%2032.92328769%2028.28027344%2034.86108398%20C29.05143131%2037.15284589%2030.0344075%2038.88085919%2031.36328125%2040.8984375%20C31.83830078%2041.62546875%2032.31332031%2042.3525%2032.80273438%2043.1015625%20C33.30095703%2043.85179687%2033.79917969%2044.60203125%2034.3125%2045.375%20C34.79912109%2046.1175%2035.28574219%2046.86%2035.78710938%2047.625%20C38.48497774%2051.73705357%2038.48497774%2051.73705357%2041.24755859%2055.80566406%20C44%2059.8014957%2044%2059.8014957%2044%2062%20C30.72016895%2063.36853221%2030.72016895%2063.36853221%2026.87890625%2060.3125%20C25.36147534%2057.94382736%2024.18346283%2055.55076454%2023%2053%20C21.90172508%2051.29498579%2020.77736043%2049.6064358%2019.625%2047.9375%20C18.75%2046.625%2017.875%2045.3125%2017%2044%20C15.38228865%2045.02562035%2015.38228865%2045.02562035%2014%2047%20C13.62355152%2049.62939205%2013.39866913%2052.05072472%2013.3125%2054.6875%20C13.27833984%2055.38939453%2013.24417969%2056.09128906%2013.20898438%2056.81445312%20C13.12670053%2058.54241387%2013.0616676%2060.27118072%2013%2062%20C8.71%2062%204.42%2062%200%2062%20C0%2041.54%200%2021.08%200%200%20Z%20%22%20fill%3D%22%2320409A%22%20transform%3D%22translate(149%2C1)%22%2F%3E%3Cpath%20d%3D%22M0%200%20C4.94309767%203.87227345%208.5284238%209.24044847%209.78515625%2015.3984375%20C9.78515625%2018.3684375%209.78515625%2021.3384375%209.78515625%2024.3984375%20C-0.44484375%2024.3984375%20-10.67484375%2024.3984375%20-21.21484375%2024.3984375%20C-20.05932649%2031.30319509%20-20.05932649%2031.30319509%20-16.21484375%2033.3984375%20C-13.15449819%2033.942881%20-10.27389573%2033.96108456%20-7.21484375%2033.3984375%20C-6.43109375%2032.5734375%20-5.64734375%2031.7484375%20-4.83984375%2030.8984375%20C-1.66590822%2027.87564176%20-0.65368646%2028.05885888%203.59765625%2028.0859375%20C5.32810903%2028.16594522%207.0582095%2028.26233837%208.78515625%2028.3984375%20C8.53719163%2033.48171223%206.88472212%2036.25611643%203.49609375%2039.8515625%20C-2.29477652%2045.08714384%20-8.32707352%2044.74724786%20-15.8125%2044.796875%20C-22.0906775%2044.06165789%20-26.19690753%2041.15651987%20-30.21484375%2036.3984375%20C-34.07436113%2030.47964742%20-35.81481635%2024.36436459%20-34.9609375%2017.296875%20C-33.29190066%209.50803642%20-29.72128075%203.9529434%20-23.21484375%20-0.6015625%20C-16.07372204%20-4.08908705%20-6.90136619%20-3.99627365%200%200%20Z%20M-20.21484375%2010.3984375%20C-20.54484375%2012.0484375%20-20.87484375%2013.6984375%20-21.21484375%2015.3984375%20C-15.27484375%2015.3984375%20-9.33484375%2015.3984375%20-3.21484375%2015.3984375%20C-5.10967857%2010.18099432%20-5.10967857%2010.18099432%20-9.21484375%207.3984375%20C-13.78135032%206.81547921%20-16.64791625%207.44298328%20-20.21484375%2010.3984375%20Z%20%22%20fill%3D%22%2320409A%22%20transform%3D%22translate(84.21484375%2C19.6015625)%22%2F%3E%3Cpath%20d%3D%22M0%200%20C1.67542976%200.28604898%203.34385343%200.61781233%205%201%20C5.33%202.32%205.66%203.64%206%205%20C6.5775%204.34%207.155%203.68%207.75%203%20C12.65173933%20-0.01645497%2017.38449299%200.2077708%2023%201%20C26.07365786%202.80803404%2027.43019732%203.86039464%2029%207%20C29.35449219%206.566875%2029.70898438%206.13375%2030.07421875%205.6875%20C33.96741478%201.6151981%2036.90443588%200.51742267%2042.5625%200.375%20C47.77357587%200.63824608%2051.18691303%201.18691303%2055%205%20C57.89149669%209.69516356%2058.41017853%2013.62812836%2058.29296875%2019.0234375%20C58.28872391%2019.76961334%2058.28447906%2020.51578918%2058.28010559%2021.28457642%20C58.26342382%2023.64843098%2058.22579339%2026.01140676%2058.1875%2028.375%20C58.17243949%2029.9856647%2058.15875348%2031.59634287%2058.14648438%2033.20703125%20C58.11355504%2037.13835515%2058.06184762%2041.06902901%2058%2045%20C55.69%2045%2053.38%2045%2051%2045%20C50.98541748%2044.15816162%2050.97083496%2043.31632324%2050.95581055%2042.44897461%20C50.89440846%2039.2970731%2050.82019269%2036.14579539%2050.73754883%2032.99438477%20C50.70449066%2031.63577457%2050.67640039%2030.27703334%2050.65356445%2028.91821289%20C50.72598803%2018.4750266%2050.72598803%2018.4750266%2047%209%20C44.39856523%207.59587831%2041.91415149%207.6875666%2039%208%20C36.00204165%209.33951331%2034.47220125%2010.0555975%2033%2013%20C32.84391977%2015.40560273%2032.74195542%2017.78702772%2032.68359375%2020.1953125%20C32.66281265%2020.90275604%2032.64203156%2021.61019958%2032.62062073%2022.33908081%20C32.55518922%2024.60095425%2032.49627026%2026.86294462%2032.4375%2029.125%20C32.39430867%2030.65756422%2032.35069418%2032.19011657%2032.30664062%2033.72265625%20C32.19951445%2037.48165073%2032.0982291%2041.24076292%2032%2045%20C29.36%2045%2026.72%2045%2024%2045%20C23.98541748%2044.08710205%2023.97083496%2043.1742041%2023.95581055%2042.23364258%20C23.89459205%2038.83201389%2023.82041127%2035.43117319%2023.73754883%2032.0300293%20C23.70438741%2030.56073578%2023.67632822%2029.09131756%2023.65356445%2027.62182617%20C23.61985481%2025.50385632%2023.56753567%2023.38702005%2023.51171875%2021.26953125%20C23.48553467%2019.99698486%2023.45935059%2018.72443848%2023.43237305%2017.41333008%20C22.97287894%2013.7858952%2022.26498601%2011.84926479%2020%209%20C16.63825863%207.74588432%2016.63825863%207.74588432%2013%208%20C9.57258371%2010.08625339%208.27518963%2011.1744311%207%2015%20C6.84854901%2017.2825699%206.75113021%2019.56887706%206.68359375%2021.85546875%20C6.66281265%2022.51710526%206.64203156%2023.17874176%206.62062073%2023.86042786%20C6.55535273%2025.96934852%206.49634656%2028.07839135%206.4375%2030.1875%20C6.39429311%2031.61915315%206.35067812%2033.05079404%206.30664062%2034.48242188%20C6.19969494%2037.98815154%206.09836359%2041.49401786%206%2045%20C3.69%2045%201.38%2045%20-1%2045%20C-1.02527124%2038.75204325%20-1.04283344%2032.50409959%20-1.05493164%2026.25610352%20C-1.05997298%2024.12881986%20-1.06680591%2022.00153969%20-1.07543945%2019.87426758%20C-1.08751379%2016.82372174%20-1.09323014%2013.77322155%20-1.09765625%2010.72265625%20C-1.10281754%209.76537125%20-1.10797882%208.80808624%20-1.11329651%207.8217926%20C-1.11337204%206.94095505%20-1.11344757%206.06011749%20-1.11352539%205.15258789%20C-1.115746%204.37315323%20-1.11796661%203.59371857%20-1.12025452%202.79066467%20C-1%201%20-1%201%200%200%20Z%20%22%20fill%3D%22%23EF5122%22%20transform%3D%22translate(280%2C18)%22%2F%3E%3Cpath%20d%3D%22M0%200%20C4.29%200%208.58%200%2013%200%20C13%204.29%2013%208.58%2013%2013%20C15.97%2013%2018.94%2013%2022%2013%20C22%2015.97%2022%2018.94%2022%2022%20C19.03%2022%2016.06%2022%2013%2022%20C13.13814223%2025.9794733%2013.28679674%2029.95848415%2013.4375%2033.9375%20C13.47681641%2035.07380859%2013.51613281%2036.21011719%2013.55664062%2037.38085938%20C13.59853516%2038.46044922%2013.64042969%2039.54003906%2013.68359375%2040.65234375%20C13.72025146%2041.65257568%2013.75690918%2042.65280762%2013.79467773%2043.68334961%20C13.74671841%2045.96069188%2013.74671841%2045.96069188%2015%2047%20C17.32817964%2047.36760731%2019.6618385%2047.70241581%2022%2048%20C22%2051.3%2022%2054.6%2022%2058%20C17.85032024%2060.07483988%2012.32368003%2059.54649512%207.890625%2058.50390625%20C3.63502479%2056.89441643%201.90275129%2055.03481299%200%2051%20C-0.34057617%2047.77026367%20-0.34057617%2047.77026367%20-0.29296875%2044.16796875%20C-0.28330078%2042.87568359%20-0.27363281%2041.58339844%20-0.26367188%2040.25195312%20C-0.23860985%2038.8971293%20-0.21321506%2037.54231159%20-0.1875%2036.1875%20C-0.17244013%2034.81316555%20-0.15875401%2033.43881532%20-0.14648438%2032.06445312%20C-0.11116628%2028.70923368%20-0.06183851%2025.35481834%200%2022%20C-2.31%2022%20-4.62%2022%20-7%2022%20C-7%2019.03%20-7%2016.06%20-7%2013%20C-4.69%2013%20-2.38%2013%200%2013%20C0%208.71%200%204.42%200%200%20Z%20%22%20fill%3D%22%2320409A%22%20transform%3D%22translate(102%2C5)%22%2F%3E%3Cpath%20d%3D%22M0%200%20C4.45587813%203.52905548%208.27584959%207.52328695%2010%2013%20C10.80111935%2020.65068975%2010.88228916%2027.73296801%206%2034%20C1.72189935%2038.53154264%20-2.50460513%2041.58537385%20-8.83203125%2042.3359375%20C-15.44895639%2042.42265998%20-20.59982907%2042.05640747%20-26%2038%20C-31.39454711%2032.60545289%20-34.121491%2027.18885059%20-34.4375%2019.5625%20C-34.21641787%2013.09805848%20-32.567526%208.76418757%20-28.1640625%204.0234375%20C-20.01265936%20-3.56579991%20-9.93549214%20-5.64335953%200%200%20Z%20M-23.875%2010.5%20C-26.70242624%2014.16009869%20-26.64133823%2017.88819615%20-26.421875%2022.375%20C-25.65273368%2027.16076824%20-23.41201166%2029.75410736%20-19.875%2032.875%20C-15.55972739%2034.56358494%20-11.57002039%2034.66646131%20-7%2034%20C-3.10804478%2032.01864098%20-0.05674494%2029.89699042%202%2026%20C3.39055814%2019.94113951%203.11418593%2016.58405753%200%2011%20C-3.36467303%206.8502366%20-6.65224134%205.24976156%20-11.9375%204.6875%20C-17.04642923%205.20881931%20-20.04000099%207.16521825%20-23.875%2010.5%20Z%20%22%20fill%3D%22%23F27723%22%20transform%3D%22translate(265%2C21)%22%2F%3E%3Cpath%20d%3D%22M0%200%20C2.5625%202.25%202.5625%202.25%204%204%20C2.95125002%206.62187494%202.35068687%207.79371361%20-0.125%209.25%20C-0.74375%209.4975%20-1.3625%209.745%20-2%2010%20C-2.639375%209.360625%20-3.27875%208.72125%20-3.9375%208.0625%20C-7.92716432%205.37558321%20-11.22598577%204.78913365%20-16%205%20C-20.70786757%206.59889842%20-23.36004134%208.7956214%20-26%2013%20C-27.6066759%2017.71291596%20-26.77591903%2021.40543534%20-25.0625%2025.94140625%20C-23.29460722%2029.36669851%20-21.53320362%2030.52247849%20-18%2032%20C-11.96257084%2032.83208158%20-8.14116339%2032.32663513%20-3%2029%20C-0.8125%2029.5625%20-0.8125%2029.5625%201%2031%20C2.25%2033.125%202.25%2033.125%203%2035%20C1.89932004%2035.81721717%200.79430269%2036.62859451%20-0.3125%2037.4375%20C-0.92738281%2037.88996094%20-1.54226562%2038.34242187%20-2.17578125%2038.80859375%20C-7.18568882%2042.08058906%20-13.26242043%2041.51033109%20-19%2041%20C-25.18446831%2039.29747638%20-29.5337175%2035.30981491%20-33%2030%20C-35.9138131%2023.97279756%20-36.10459185%2017.13872389%20-34.3828125%2010.6875%20C-31.5467084%204.26234381%20-26.26707079%20-0.43452858%20-20%20-3.4375%20C-12.20856133%20-4.89839475%20-6.83367637%20-3.97400433%200%200%20Z%20%22%20fill%3D%22%23A5206F%22%20transform%3D%22translate(226%2C22)%22%2F%3E%3Cpath%20d%3D%22M0%200%20C4.29%200%208.58%200%2013%200%20C13%2014.85%2013%2029.7%2013%2045%20C8.71%2045%204.42%2045%200%2045%20C0%2030.15%200%2015.3%200%200%20Z%20%22%20fill%3D%22%2320409A%22%20transform%3D%22translate(129%2C18)%22%2F%3E%3Cpath%20d%3D%22M0%200%20C5.14241583%202.30522089%206.90375857%204.86904655%209%2010%20C9.24713645%2012.75907028%209.35266646%2015.27547925%209.29296875%2018.0234375%20C9.28872391%2018.76961334%209.28447906%2019.51578918%209.28010559%2020.28457642%20C9.26342382%2022.64843098%209.22579339%2025.01140676%209.1875%2027.375%20C9.17243949%2028.9856647%209.15875348%2030.59634287%209.14648438%2032.20703125%20C9.11355504%2036.13835515%209.06184762%2040.06902901%209%2044%20C6.69%2044%204.38%2044%202%2044%20C1.98541748%2043.15816162%201.97083496%2042.31632324%201.95581055%2041.44897461%20C1.89440846%2038.2970731%201.82019269%2035.14579539%201.73754883%2031.99438477%20C1.70449066%2030.63577457%201.67640039%2029.27703334%201.65356445%2027.91821289%20C1.72333362%2017.47632173%201.72333362%2017.47632173%20-2%208%20C-6.85483469%206.56742583%20-8.82194923%206.51615772%20-13.5%208.4375%20C-14.7375%209.2109375%20-14.7375%209.2109375%20-16%2010%20C-15.67%208.02%20-15.34%206.04%20-15%204%20C-15.66%203.67%20-16.32%203.34%20-17%203%20C-12.10266301%20-1.50316108%20-6.27517194%20-0.69463968%200%200%20Z%20%22%20fill%3D%22%23ED3B3E%22%20transform%3D%22translate(329%2C19)%22%2F%3E%3Cpath%20d%3D%22M0%200%20C1.67225729%200.30404678%203.34080104%200.63128912%205%201%20C5%202.32%205%203.64%205%205%20C3.04109119%206.39300182%201.0360882%207.72245446%20-1%209%20C-4.63842873%2012.89345878%20-4.49928436%2016.17135785%20-4.35546875%2021.30078125%20C-3.85936188%2025.06792244%20-2.55934632%2027.22737482%200%2030%20C3.48000276%2032.61000207%207.78794699%2032.5787947%2012%2033%20C9%2035%209%2035%205.4375%2036.5%20C2.00994231%2037.74653251%202.00994231%2037.74653251%200%2040%20C-6.65751664%2035.93610647%20-10.64986917%2031.52691671%20-13%2024%20C-14.12611084%2016.83474605%20-13.17020355%2010.96514553%20-9%205%20C-4.83333333%200%20-4.83333333%200%200%200%20Z%20%22%20fill%3D%22%239D216D%22%20transform%3D%22translate(244%2C22)%22%2F%3E%3Cpath%20d%3D%22M0%200%20C2.40763065%201.40011527%204.22179974%203.00575077%205.98828125%205.15625%20C4.93953127%207.77812494%204.33896812%208.94996361%201.86328125%2010.40625%20C1.24453125%2010.65375%200.62578125%2010.90125%20-0.01171875%2011.15625%20C-0.67171875%2010.5375%20-1.33171875%209.91875%20-2.01171875%209.28125%20C-4.75664518%207.33692711%20-5.99902444%206.77107516%20-9.13671875%206.09375%20C-12.90627925%205.18175956%20-13.63998885%204.87416408%20-16.01171875%202.15625%20C-17.59592004%202.77904669%20-19.17904406%203.40458401%20-20.76171875%204.03125%20C-21.6434375%204.37929688%20-22.52515625%204.72734375%20-23.43359375%205.0859375%20C-25.68574355%206.0209209%20-27.84821334%207.03405794%20-30.01171875%208.15625%20C-22.28881336%20-2.62553165%20-11.96925519%20-5.78824085%200%200%20Z%20%22%20fill%3D%22%23C23E76%22%20transform%3D%22translate(224.01171875%2C20.84375)%22%2F%3E%3Cpath%20d%3D%22M0%200%20C2.86999405%202.86999405%204%204.68643548%204%208.8125%20C2.21916365%2014.48891588%20-1.52759576%2018.42588121%20-6.625%2021.4375%20C-11.81947994%2023.79313625%20-17.41518135%2023.52411375%20-23%2023%20C-23.66%2022.67%20-24.32%2022.34%20-25%2022%20C-24%2019%20-24%2019%20-21.0625%2017.4375%20C-18.0276772%2016.21731352%20-15.0989415%2015.64063788%20-11.875%2015.125%20C-7.16838921%2014.23088701%20-4.78803868%2013.0949318%20-2%209%20C-1.05817198%206.03000265%20-0.44968422%203.08067249%200%200%20Z%20%22%20fill%3D%22%23EF4D21%22%20transform%3D%22translate(270%2C40)%22%2F%3E%3Cpath%20d%3D%22M0%200%20C0.99%200.66%201.98%201.32%203%202%20C2%205%202%205%20-0.21484375%206.38671875%20C-1.56255859%207.03060547%20-1.56255859%207.03060547%20-2.9375%207.6875%20C-4.28134766%208.34298828%20-4.28134766%208.34298828%20-5.65234375%209.01171875%20C-8%2010%20-8%2010%20-10%2010%20C-12.1543038%2014.4399676%20-12.41745846%2018.47418774%20-12.625%2023.3125%20C-12.66367188%2024.05306641%20-12.70234375%2024.79363281%20-12.7421875%2025.55664062%20C-12.83581705%2027.37071309%20-12.91896851%2029.18532116%20-13%2031%20C-15.9425543%2028.31331999%20-16.899082%2026.34492639%20-17.203125%2022.29296875%20C-17.36621455%2011.48828607%20-17.36621455%2011.48828607%20-14%207%20C-9.71520247%203.5123741%20-5.25372341%201.55027904%200%200%20Z%20%22%20fill%3D%22%237C2167%22%20transform%3D%22translate(208%2C22)%22%2F%3E%3Cpath%20d%3D%22M0%200%20C3.25%202%203.25%202%205%204%20C4.5206753%208.31392226%203.2542015%2010.16569547%200%2013%20C-0.350625%2012.195625%20-0.70125%2011.39125%20-1.0625%2010.5625%20C-2.83898202%207.61910611%20-2.83898202%207.61910611%20-6.5625%207.3125%20C-7.696875%207.209375%20-8.83125%207.10625%20-10%207%20C-10.66%206.34%20-11.32%205.68%20-12%205%20C-16.07763771%207.86536704%20-18.02677065%2010.43041625%20-20%2015%20C-20.33%2015%20-20.66%2015%20-21%2015%20C-20.74086272%208.65113652%20-18.61254026%205.3311386%20-14%201%20C-9.83397604%20-1.08301198%20-4.53725057%20-0.46520412%200%200%20Z%20%22%20fill%3D%22%23F05822%22%20transform%3D%22translate(303%2C19)%22%2F%3E%3Cpath%20d%3D%22M0%200%20C5.80794033%202.42378612%209.61455607%206.80371947%2012.875%2012.0625%20C13.93350249%2014.9266832%2014.20413247%2016.91566528%2013.9375%2019.9375%20C11.28066873%2017.38694198%208.91194207%2014.70370741%206.5625%2011.875%20C1.74803069%206.42198002%20-2.09531333%204.90604694%20-9.3125%204.3125%20C-10.34890625%204.25835938%20-11.3853125%204.20421875%20-12.453125%204.1484375%20C-15.0625%203.9375%20-15.0625%203.9375%20-17.0625%202.9375%20C-17.3925%203.5975%20-17.7225%204.2575%20-18.0625%204.9375%20C-18.0625%203.9475%20-18.0625%202.9575%20-18.0625%201.9375%20C-12.00117555%20-1.69929467%20-6.61520629%20-2.06005457%200%200%20Z%20%22%20fill%3D%22%23DE7964%22%20transform%3D%22translate(261.0625%2C19.0625)%22%2F%3E%3Cpath%20d%3D%22M0%200%20C2.4375%202.125%202.4375%202.125%204%205%20C4.0625%208.125%204.0625%208.125%203%2011%20C0.8125%2013%200.8125%2013%20-2%2014%20C-5.1875%2013.375%20-5.1875%2013.375%20-8%2012%20C-10%209%20-10%209%20-9.8125%205.4375%20C-8.4902781%20-0.15651573%20-5.28334695%20-0.75476385%200%200%20Z%20%22%20fill%3D%22%232D4CA7%22%20transform%3D%22translate(139%2C1)%22%2F%3E%3Cpath%20d%3D%22M0%200%20C2.1875%200.5625%202.1875%200.5625%204%202%20C5.25%204.125%205.25%204.125%206%206%20C-2.06200909%2012.41670112%20-2.06200909%2012.41670112%20-8%2012%20C-10.9872535%209.96467059%20-13.50080895%207.60305354%20-16%205%20C-15.67%204.34%20-15.34%203.68%20-15%203%20C-14.00419922%203.05220703%20-14.00419922%203.05220703%20-12.98828125%203.10546875%20C-7.54401494%203.27237326%20-4.64933186%203.0083912%200%200%20Z%20%22%20fill%3D%22%23691E5F%22%20transform%3D%22translate(223%2C51)%22%2F%3E%3Cpath%20d%3D%22M0%200%20C0.7425%201.0209375%200.7425%201.0209375%201.5%202.0625%20C6.53016788%207.97294725%2012.13083366%2012.4223092%2019%2016%20C17.35%2017.65%2015.7%2019.3%2014%2021%20C6.51161312%2017.11179912%202.90577503%2013.13617008%200%205%20C-0.1875%202.0625%20-0.1875%202.0625%200%200%20Z%20%22%20fill%3D%22%23A2204C%22%20transform%3D%22translate(231%2C41)%22%2F%3E%3Cpath%20d%3D%22M0%200%20C2.74342235%201.01756029%203.85516913%201.91474777%206%204%20C6.33%204.99%206.66%205.98%207%207%20C6.360625%206.835%205.72125%206.67%205.0625%206.5%20C-2.13346485%205.3251486%20-7.47984776%205.67339172%20-14%209%20C-14.99%209.495%20-14.99%209.495%20-16%2010%20C-15.67%208.02%20-15.34%206.04%20-15%204%20C-15.66%203.67%20-16.32%203.34%20-17%203%20C-12.11210083%20-1.4944829%20-6.26553024%20-0.71517219%200%200%20Z%20%22%20fill%3D%22%23E12B41%22%20transform%3D%22translate(329%2C19)%22%2F%3E%3Cpath%20d%3D%22M0%200%20C8.01426231%20-0.48817841%2013.94912244%200.01162482%2021%204%20C19.48052501%207.36748512%2018.47899158%208.60840337%2015%2010%20C14.34%209.38125%2013.68%208.7625%2013%208.125%20C10.20868138%206.14781598%209.00841307%205.64034688%205.8125%205%20C2%204%202%204%200.76171875%201.9375%20C0.51035156%201.298125%200.25898438%200.65875%200%200%20Z%20%22%20fill%3D%22%23C12A63%22%20transform%3D%22translate(209%2C22)%22%2F%3E%3Cpath%20d%3D%22M0%200%20C1.41623216%20-0.05447047%202.83308191%20-0.09300508%204.25%20-0.125%20C5.03890625%20-0.14820312%205.8278125%20-0.17140625%206.640625%20-0.1953125%20C9.20731941%200.0171622%2010.7916067%200.71345895%2013%202%20C12.67%202.66%2012.34%203.32%2012%204%20C12.33%204.66%2012.66%205.32%2013%206%20C13.50030131%2011.71274291%2012.83950258%2016.59646117%2011%2022%20C10.34%2022%209.68%2022%209%2022%20C8.87882812%2020.87980469%208.75765625%2019.75960937%208.6328125%2018.60546875%20C8.46396733%2017.13276364%208.29467303%2015.66010996%208.125%2014.1875%20C8.04636719%2013.44951172%207.96773438%2012.71152344%207.88671875%2011.95117188%20C7.45539714%208.28493819%207.0803217%206.12048255%205%203%20C2.44816596%201.79549696%202.44816596%201.79549696%200%201%20C0%200.67%200%200.34%200%200%20Z%20%22%20fill%3D%22%23EE4B4E%22%20transform%3D%22translate(322%2C24)%22%2F%3E%3Cpath%20d%3D%22M0%200%20C0.515625%200.70125%201.03125%201.4025%201.5625%202.125%20C6.96713441%208.49969699%2011.86124567%2011.89610432%2020%2014%20C20%2014.33%2020%2014.66%2020%2015%20C12.32299452%2015.54835753%207.67600472%2013.66510342%201.5%209.1875%20C-0.616543%206.10087479%20-0.28063841%203.64829932%200%200%20Z%20%22%20fill%3D%22%23AB387E%22%20transform%3D%22translate(195%2C48)%22%2F%3E%3Cpath%20d%3D%22M0%200%20C0.33%200%200.66%200%201%200%20C1%209.9%201%2019.8%201%2030%20C-0.32%2030%20-1.64%2030%20-3%2030%20C-2.01%2020.1%20-1.02%2010.2%200%200%20Z%20%22%20fill%3D%22%23EC2123%22%20transform%3D%22translate(337%2C33)%22%2F%3E%3Cpath%20d%3D%22M0%200%20C0.66%200.33%201.32%200.66%202%201%20C1.34%201.66%200.68%202.32%200%203%20C0.32198966%206.09926819%200.32198966%206.09926819%201%209%20C5.10223585%2010.01540112%205.10223585%2010.01540112%209%209%20C8%2012%208%2012%205.25%2013.375%20C2%2014%202%2014%20-0.8125%2013.0625%20C-3%2011%20-3%2011%20-4.0625%207.5625%20C-4%204%20-4%204%20-2.0625%201.5625%20C-1.381875%201.046875%20-0.70125%200.53125%200%200%20Z%20%22%20fill%3D%22%232140A4%22%20transform%3D%22translate(133%2C1)%22%2F%3E%3Cpath%20d%3D%22M0%200%20C1.22589844%200.01353516%201.22589844%200.01353516%202.4765625%200.02734375%20C3.41628906%200.04474609%203.41628906%200.04474609%204.375%200.0625%20C3.8078125%200.33707031%203.240625%200.61164062%202.65625%200.89453125%20C-4.36423151%204.48892161%20-9.27927681%207.78918872%20-12.625%2015.0625%20C-12.955%2015.0625%20-13.285%2015.0625%20-13.625%2015.0625%20C-13.36586272%208.71363652%20-11.23754026%205.3936386%20-6.625%201.0625%20C-4.21954362%20-0.14022819%20-2.67503047%20-0.03821472%200%200%20Z%20%22%20fill%3D%22%23F26D4F%22%20transform%3D%22translate(295.625%2C18.9375)%22%2F%3E%3Cpath%20d%3D%22M0%200%20C1.32%200.66%202.64%201.32%204%202%20C4%202.66%204%203.32%204%204%20C-0.87681074%206.38864199%20-4.43901174%207.65423391%20-10%207%20C-10.66%206.01%20-11.32%205.02%20-12%204%20C-11.38511719%203.87882812%20-10.77023438%203.75765625%20-10.13671875%203.6328125%20C-9.32847656%203.46523438%20-8.52023438%203.29765625%20-7.6875%203.125%20C-6.88699219%202.96257813%20-6.08648437%202.80015625%20-5.26171875%202.6328125%20C-2.74698882%202.05521001%20-2.74698882%202.05521001%200%200%20Z%20%22%20fill%3D%22%2378356F%22%20transform%3D%22translate(223%2C51)%22%2F%3E%3Cpath%20d%3D%22M0%200%20C10.33480176%20-0.40528634%2010.33480176%20-0.40528634%2014%202%20C14.8125%204.625%2014.8125%204.625%2015%207%20C14.360625%206.690625%2013.72125%206.38125%2013.0625%206.0625%20C9.64997844%204.87856395%206.57324671%204.58475608%202.98828125%204.34375%20C1%204%201%204%20-1%202%20C-0.67%201.34%20-0.34%200.68%200%200%20Z%20%22%20fill%3D%22%23D05044%22%20transform%3D%22translate(249%2C23)%22%2F%3E%3Cpath%20d%3D%22M0%200%20C0.33%200%200.66%200%201%200%20C1.62176166%208.89464594%201.62176166%208.89464594%20-0.6875%2013%20C-3.13117269%2015.11344665%20-4.86848101%2016.21712025%20-8%2017%20C-10.15625%2016.5390625%20-10.15625%2016.5390625%20-12%2016%20C-11.45730469%2015.72027344%20-10.91460937%2015.44054688%20-10.35546875%2015.15234375%20C-3.9016412%2011.53587462%20-2.30824313%208.63831657%20-0.3125%201.5625%20C-0.1578125%200.7890625%20-0.1578125%200.7890625%200%200%20Z%20%22%20fill%3D%22%23F48665%22%20transform%3D%22translate(268%2C39)%22%2F%3E%3Cpath%20d%3D%22M0%200%20C1.67542976%200.28604898%203.34385343%200.61781233%205%201%20C5.38218767%202.65614657%205.71395102%204.32457024%206%206%20C5%207%205%207%201.9375%207.0625%20C0.4834375%207.0315625%200.4834375%207.0315625%20-1%207%20C-1.04254356%205.00045254%20-1.04080783%202.99958364%20-1%201%20C-0.67%200.67%20-0.34%200.34%200%200%20Z%20%22%20fill%3D%22%233D5CAB%22%20transform%3D%22translate(135%2C3)%22%2F%3E%3Cpath%20d%3D%22M0%200%20C1.67225729%200.30404678%203.34080104%200.63128912%205%201%20C4.67%201.99%204.34%202.98%204%204%20C2.39602723%204.16852247%200.7918131%204.33474886%20-0.8125%204.5%20C-1.70582031%204.5928125%20-2.59914062%204.685625%20-3.51953125%204.78125%20C-6%205%20-6%205%20-9%205%20C-4.5%200%20-4.5%200%200%200%20Z%20%22%20fill%3D%22%23B93B64%22%20transform%3D%22translate(244%2C22)%22%2F%3E%3Cpath%20d%3D%22M0%200%20C0.99%200%201.98%200%203%200%20C2.67%205.61%202.34%2011.22%202%2017%20C1.34%2017%200.68%2017%200%2017%20C0%2011.39%200%205.78%200%200%20Z%20%22%20fill%3D%22%23ED3235%22%20transform%3D%22translate(331%2C46)%22%2F%3E%3Cpath%20d%3D%22M0%200%20C0.33%200.66%200.66%201.32%201%202%20C1.66%202.33%202.32%202.66%203%203%20C1.06629769%204.00732399%20-0.87210306%205.00563288%20-2.8125%206%20C-4.43091797%206.8353125%20-4.43091797%206.8353125%20-6.08203125%207.6875%20C-9%209%20-9%209%20-12%209%20C-10.56771184%207.68181446%20-9.12897516%206.37063296%20-7.6875%205.0625%20C-6.88699219%204.33160156%20-6.08648437%203.60070312%20-5.26171875%202.84765625%20C-3%201%20-3%201%200%200%20Z%20%22%20fill%3D%22%23993578%22%20transform%3D%22translate(206%2C19)%22%2F%3E%3Cpath%20d%3D%22M0%200%20C3.21043882%201.38188453%205.04936365%202.92421903%207.25%205.625%20C8.03117187%206.57246094%208.03117187%206.57246094%208.828125%207.5390625%20C9.40820312%208.26222656%209.40820312%208.26222656%2010%209%20C8.1328125%209.59765625%208.1328125%209.59765625%206%2010%20C2.30489146%207.28300842%201.18462169%204.34361288%200%200%20Z%20%22%20fill%3D%22%23EC6E25%22%20transform%3D%22translate(262%2C26)%22%2F%3E%3Cpath%20d%3D%22M0%200%20C0%200.99%200%201.98%200%203%20C-3.96%204.98%20-3.96%204.98%20-8%207%20C-8%205.68%20-8%204.36%20-8%203%20C-5.36%202.01%20-2.72%201.02%200%200%20Z%20%22%20fill%3D%22%23F16523%22%20transform%3D%22translate(300%2C19)%22%2F%3E%3Cpath%20d%3D%22M0%200%20C2.97%200.495%202.97%200.495%206%201%20C5.67%201.66%205.34%202.32%205%203%20C4.01%203%203.02%203%202%203%20C2%205.97%202%208.94%202%2012%20C1.67%2012%201.34%2012%201%2012%20C1%209.36%201%206.72%201%204%20C0.34%204%20-0.32%204%20-1%204%20C-0.67%202.68%20-0.34%201.36%200%200%20Z%20%22%20fill%3D%22%23F3783C%22%20transform%3D%22translate(268%2C35)%22%2F%3E%3Cpath%20d%3D%22M0%200%20C3.3%200.99%206.6%201.98%2010%203%20C10%203.33%2010%203.66%2010%204%20C8.741875%204.020625%207.48375%204.04125%206.1875%204.0625%20C5.47980469%204.07410156%204.77210938%204.08570313%204.04296875%204.09765625%20C2%204%202%204%20-1%203%20C-0.67%202.01%20-0.34%201.02%200%200%20Z%20%22%20fill%3D%22%23963779%22%20transform%3D%22translate(205%2C59)%22%2F%3E%3Cpath%20d%3D%22M0%200%20C0.99%200.33%201.98%200.66%203%201%20C0.64722731%203.72426311%20-1.62496331%204.8141763%20-5%206%20C-3.35%204.02%20-1.7%202.04%200%200%20Z%20%22%20fill%3D%22%23B9518A%22%20transform%3D%22translate(240%2C22)%22%2F%3E%3Cpath%20d%3D%22M0%200%20C2.64%200%205.28%200%208%200%20C4.77484237%201.73662334%201.48670834%202.8905928%20-2%204%20C-1.34%202.68%20-0.68%201.36%200%200%20Z%20%22%20fill%3D%22%23F4804F%22%20transform%3D%22translate(292%2C19)%22%2F%3E%3Cpath%20d%3D%22M0%200%20C2.35171131%200.59861742%204.6859378%201.26924352%207%202%20C7.33%202.66%207.66%203.32%208%204%20C2.25%203.125%202.25%203.125%200%202%20C0%201.34%200%200.68%200%200%20Z%20%22%20fill%3D%22%238D216B%22%20transform%3D%22translate(206%2C58)%22%2F%3E%3Cpath%20d%3D%22M0%200%20C0.94875%200.04125%201.8975%200.0825%202.875%200.125%20C1.555%201.445%200.235%202.765%20-1.125%204.125%20C-2.445%203.465%20-3.765%202.805%20-5.125%202.125%20C-3.125%200.125%20-3.125%200.125%200%200%20Z%20%22%20fill%3D%22%23E82C2F%22%20transform%3D%22translate(317.125%2C19.875)%22%2F%3E%3C%2Fsvg%3E',
                      alt: 'Company Logo',
                      width: '150px',
                    },
                    styles: {
                      desktop: {
                        width: '150px',
                        cursor: 'pointer',
                      },
                    },
                  },
                ],
              },
              
              // Hamburger Icon (Mobile)
              {
                id: generateId(),
                type: 'icon', // Using generic icon or SVG
                props: { content: 'menu' }, // Material symbol fallback or replace with SVG path if possible, but 'menu' is standard
                styles: {
                  desktop: { display: 'none', cursor: 'pointer', fontSize: '24px', color: '#111' },
                  tablet: { display: 'block' }, // md:hidden (so show on small)
                  mobile: { display: 'block' },
                },
              },

              // Nav Links
              {
                id: generateId(),
                type: 'container',
                props: { tagName: 'ul' }, // ul
                styles: {
                  desktop: {
                    display: 'flex',
                    alignItems: 'center',
                    gap: '0',
                  },
                  tablet: {
                    display: 'none', // hidden on mobile/tablet default (requires JS toggle)
                    width: '100%',
                    paddingTop: '16px',
                  },
                  mobile: {
                    display: 'none',
                    width: '100%',
                    paddingTop: '16px',
                  }
                },
                children: [
                  { text: 'Features', highlight: false },
                  { text: 'Pricing', highlight: false },
                  { text: 'Customers', highlight: false },
                  { text: 'Blog', highlight: false },
                  { text: 'Sign Up', highlight: true },
                ].map(link => ({
                  id: generateId(),
                  type: 'container',
                  props: { tagName: 'li' },
                  styles: { desktop: {} },
                  children: [
                    {
                      id: generateId(),
                      type: 'button', // or text link
                      props: { content: link.text, href: '#' },
                      styles: {
                        desktop: {
                          padding: '8px 16px', // md:p-4
                          display: 'block',
                          color: link.highlight ? '#a855f7' : '#374151', // text-purple-500 or gray-700
                          backgroundColor: 'transparent',
                          border: 'none',
                          cursor: 'pointer',
                          fontWeight: '500',
                          fontSize: '16px',
                        },
                        tablet: {
                          padding: '8px 0', // py-2
                          width: '100%',
                          textAlign: 'left',
                        }
                      }
                    }
                  ]
                })),
              }
            ],
          },
        ],
      },
      // Main Content Section
      {
        id: generateId(),
        type: 'container',
        props: {},
        styles: {
          desktop: {
            width: '100%',
            padding: '60px 20px',
            backgroundColor: '#ffffff',
            minHeight: '400px',
            display: 'flex',
            flexDirection: 'column',
            alignItems: 'center',
            gap: '20px',
          },
        },
        children: [
          {
            id: generateId(),
            type: 'heading',
            props: { content: 'Welcome to Your New Site', level: 1 },
            styles: {
              desktop: {
                fontSize: '48px',
                fontWeight: '800',
                color: '#111111',
                textAlign: 'center',
                lineHeight: '1.2',
                margin: '0',
              },
            },
          },
          {
            id: generateId(),
            type: 'text',
            props: { content: 'Start building your amazing website today. Drag and drop elements to customize this page.' },
            styles: {
              desktop: {
                fontSize: '18px',
                color: '#666666',
                textAlign: 'center',
                maxWidth: '600px',
                lineHeight: '1.6',
                margin: '0',
              },
            },
          },
          {
            id: generateId(),
            type: 'button',
            props: { content: 'Get Started', href: '#' },
            styles: {
              desktop: {
                padding: '6px 12px',
                backgroundColor: '#6C5CE7',
                color: '#ffffff',
                borderRadius: '8px',
                fontSize: '16px',
                fontWeight: '600',
                border: 'none',
                marginTop: '20px',
                cursor: 'pointer',
              },
            },
          }
        ],
      },
      // Footer Section
      {
        id: generateId(),
        type: 'container',
        props: {},
        styles: {
          desktop: {
            width: '100%',
            padding: '20px',
            backgroundColor: '#f5f5f5',
            borderTop: '1px solid #e5e5e5',
            marginTop: 'auto',
          },
        },
        children: [
          {
            id: generateId(),
            type: 'text',
            props: { content: 'Â© 2024 My Website. All rights reserved.' },
            styles: {
              desktop: {
                fontSize: '14px',
                color: '#888888',
                textAlign: 'center',
                width: '100%',
                margin: '0',
              },
            },
          },
        ],
      },
    ];

    const newProject = {
      id: `project-${Date.now()}`,
      userId: decoded.userId,
      name: name || 'Untitled Project',
      slug: name?.toLowerCase().replace(/\s+/g, '-') || 'untitled',
      status: 'draft',
      draftStructure: defaultStructure,
      publishedStructure: null,
      createdAt: new Date().toISOString(),
      updatedAt: new Date().toISOString(),
    };

    global.projects.push(newProject);

    return NextResponse.json(newProject);
  } catch (error) {
    return NextResponse.json({ message: 'Failed to create project' }, { status: 500 });
  }
}
